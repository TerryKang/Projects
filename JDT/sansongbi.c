#include <stdio.h>
#include <string.h>
#include <time.h>
#include <stdlib.h>
#include <windows.h>
#include "conio.h"
#include "cmd.h"
#include <mmsystem.h>

#define LEFT 75
#define RIGHT 77
#define UP 72
#define DOWN 80
#define ESC 27
#define ENTER 13
#define KORNUM 2780			//한글 단어 갯수

typedef struct korwords {	//파일에 있는 단어를 저장할 String의 구조체
	char korword[20];
}korwords;

typedef struct viewwords {	//화면에 보여질 단어
	char words[20];
	int x;					//x좌표
	int y;					//y좌표
}viewwords;

struct rank{				//랭킹 구조체(이름, 스테이지, 점수)
	char name[15];
	int stage;
	int score;
};

void noCursor(void);
void gotoxy(int x, int y);
void textcolor(unsigned int text, unsigned int back);
void noCursor(void);
void ready(int level);
void korsanrank(int totalscore, int stage);			//한글 산성비 랭킹
void engsanrank(int totalscore, int stage);			//영문 산성비 랭킹
void korsanrankupdate(char name[], int stage, int score);	//한글 산성비 랭킹 업데이트 
void engsanrankupdate(char name[], int stage, int score);	//영문 산성비 랭킹 업데이트 
void korsanrankview(void);							//한글 산성비 랭킹 보기 
void engsanrankview(void);							//영문 산성비 랭킹 보기 
void korsanrankformat(void);						//한글 산성비 랭킹 초기화	
void engsanrankformat(void);						//영문 산성비 랭킹 초기화	
void jawon_GameOver(void);
void cls(void);
	

int sansongbi(int stage)
{
	korwords kor[KORNUM];
	viewwords view[40];		//화면에 뿌려질 40개의 단어
	FILE* fp;
	int index[40];			//랜덤 인덱스 값 40개
	int temp;
	int check;				//중복체크를 위한 변수.
	int i, j;				//루프 변수
	int time1, time2;		//시간 측정.
	int score=0;
	int count=0;
	char cmpstring[20];			
	int ch_pointer;
	char ch;
	int templife=20, countlife=20;				//HP
	char* menu[3]={
		"┌───────────────────────────────┐",
		"│　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　│",
		"└───────────────────────────────┘"};

	noCursor();

	fp=fopen("wordkor.dat", "rb");
	if(fp==NULL)
		printf("File Open Error!\n");

	for(i=0; i<KORNUM; i++)
		fscanf(fp, "%s", kor[i].korword);

	srand((int)time(NULL));

	while(1)
	{
		ready(stage);
		count=0;
		templife=20;
		cls();
		textcolor(10, 0);								//테두리..
		gotoxy(0,0), printf("%s", menu[0]);
		for(i=1; i<21; i++)
			gotoxy(0, i), printf("%s", menu[1]);
		gotoxy(0, i), printf("%s", menu[2]);
		
		textcolor(11, 0);
		gotoxy(15, 22), printf("┌───────────┐");
		gotoxy(15, 23), printf("│　　　　　　　　　　　│");
		gotoxy(15, 24), printf("└───────────┘");  
		textcolor(15, 0);

		textcolor(11, 0);
		gotoxy(66, 0), printf("┌─────┐");
		gotoxy(66, 1), printf("│　　　　　│");	//산성비
		gotoxy(66, 2), printf("├─────┤");
		gotoxy(66, 3), printf("│　　　　　│");	//한글
		gotoxy(66, 4), printf("├─────┤");
		gotoxy(66, 5), printf("│　　　　　│");	//Stage
		gotoxy(66, 6), printf("├─────┤");
		gotoxy(66, 7), printf("│　　　　　│");	//점수
		gotoxy(66, 8), printf("├─────┤");	//
		for(i=1; i<=10; i++)
			gotoxy(66, 8+i), printf("│　　　　　│");
		gotoxy(66, 8+i), printf("├─────┤");
		gotoxy(66, 9+i), printf("│　　　　　│");
		gotoxy(66, 10+i), printf("└─────┘");
		textcolor(11, 0);

		//HP막대 ♥
		textcolor(12, 0);
		for(i=1; i<=10; i++)
			gotoxy(70, 8+i), printf("♥");

		for(i=1 ; i<=10; i++)
			gotoxy(74, 8+i), printf("♥");
		textcolor(15, 0);

		textcolor(12, 0);
		if(countlife>=10)
		{
			for(i=1; i<=(20-countlife); i++)
			{
				gotoxy(70, 8+i), printf("　");
				gotoxy(19+ch_pointer, 23);
			}
		}
		else
		{	
			for(i=1; i<=10; i++)
				gotoxy(70, 8+i), printf("  ");

			for(i=1 ; i<=(10-countlife); i++)
			{
				gotoxy(74, 8+i), printf("　");
				gotoxy(19+ch_pointer, 23);
			}
		}
		textcolor(15, 0);

		textcolor(14, 0);
		gotoxy(69, 1), printf("산 성 비");
		textcolor(15, 0);

		textcolor(9, 0);
		gotoxy(70, 3), printf("한  글");
		textcolor(15, 0);

		textcolor(13, 0);
		gotoxy(69, 5), printf("Stage %2d", stage);	
		textcolor(15, 0);

		textcolor(10, 0);
		gotoxy(69, 7), printf("%5d 점", 0);
		textcolor(15, 0);

		textcolor(10, 0);
		gotoxy(69, 7), printf("%5d", score*50);
		textcolor(15, 0);

		textcolor(12, 0);
		gotoxy(70, 20), printf("H    P");
		textcolor(15, 0);

		textcolor(8, 0);
		gotoxy(60, 23), printf("Press ESC to quit");
		textcolor(15, 0);

		for(i=0; i<40; i++, check=0)			//중복 방지.
		{
			temp=rand()%KORNUM;
			if(i>0)								//i가 1 이상일 경우부터 중복 검사.
			{
				for(j=0; j<i; j++ )			
				{
					if(temp==index[j])			//난수로 생성된 temp 값이 index 중에 있는지 검사..
						check++;
				}
				if(check!=0)					//만약 중복이 되었다면 새로운 난수 생성..
				{
					i--;
					continue;
				}
				else
					index[i]=temp;				//중복되지 않았다면 index에 대입
			}
			index[i]=temp;
		}
		
		for(i=0; i<40; i++)
		{
			for(j=0; j<=strlen(kor[index[i]].korword); j++)
				view[i].words[j]=kor[index[i]].korword[j];
			view[i].x=(rand()%4)*15+5;
			view[i].y = -2*i;
		}
		
		time1=GetTickCount();
		ch_pointer=0;

		gotoxy(19+ch_pointer, 23);
		cmpstring[ch_pointer]='\0';
		for(j=0; j<40; j++)
		{
			if(strcmp(cmpstring,view[j].words)==0)
			{
	//			sndPlaySound("MsgBell.wav", SND_ASYNC|SND_NODEFAULT);
				strcpy(view[j].words, "             ");

			}
			gotoxy(19+ch_pointer, 23);
		}
		gotoxy(19,23), printf("               ");
		gotoxy(19,23);
		ch_pointer=0;



		while(1)
		{
			ch='\0';
			if(kbhit())
			{
				ch=getch();
				if(ch==-32)
					ch=getch();

				if(ch_pointer==0)
					gotoxy(19, 23);
			}

			time2=GetTickCount();
			if( (time2-time1)>(900-(stage*50)) )
			{
				for(i=0; i<40; i++)
				{
					gotoxy(19+ch_pointer, 23);
					if(view[i].y>0 && view[i].y<=19)
					{
						if(view[i].y>1)
						{
							gotoxy(view[i].x, view[i].y-1), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[i].x, view[i].y-1), printf("             ");
							gotoxy(19+ch_pointer, 23);
							if(view[i].y!=19)
								gotoxy(view[i].x, view[i].y+1), printf("             ");
							gotoxy(19+ch_pointer, 23);
						}
						if(view[i].y!=19)
						{
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[i].x, view[i].y), printf("%s", view[i].words);
							gotoxy(19+ch_pointer, 23);
						}
					}
					view[i].y++;
				}
				time1=GetTickCount();

				for(i=0; i<40; i++)
				{
					if(view[i].words[0]!=' ' && view[i].y==20)
					{
						strcpy(view[i].words, "             ");
						templife--;
						countlife--;
					}
				}
	//			gotoxy(60, 23), printf("%2d", life);
				gotoxy(19+ch_pointer, 23);

				textcolor(12, 0);

				if(countlife>=10)
				{
					for(i=1; i<=(20-countlife); i++)
					{
						gotoxy(70, 8+i), printf("　");
						gotoxy(19+ch_pointer, 23);
					}
				}

				else
				{	
					for(i=1 ; i<=(10-countlife); i++)
					{
						gotoxy(74, 8+i), printf("　");
						gotoxy(19+ch_pointer, 23);
					}
				}

				textcolor(15, 0);
			}

			if(ch!='\0')
			{
				if(ch_pointer==15 || ch==13) 
				{//엔터면 입력 종료.
					gotoxy(19+ch_pointer, 23);
					cmpstring[ch_pointer]='\0';
					for(j=0; j<40; j++)
					{
						if(strcmp(cmpstring,view[j].words)==0)
						{
							sndPlaySound("MsgBell.wav", SND_ASYNC|SND_NODEFAULT);
							strcpy(view[j].words, "             ");
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							count++;
							score++;
							textcolor(10, 0);
							gotoxy(69, 7), printf("%5d", score*50);
							textcolor(15, 0);
							gotoxy(19+ch_pointer, 23);
							
						}
						gotoxy(19+ch_pointer, 23);
					}
					gotoxy(19,23), printf("               ");
					gotoxy(19,23);
					ch_pointer=0;
				}

				else if ( ch == 8 )
				{ // 백스페이스 누르면
					if ( ch_pointer > 0 )
					{
			    		if(cmpstring[ch_pointer-1]>0)							//한글이 아닐경우
			    			gotoxy(19+ch_pointer, 23), printf("\b \b");			// 화면에 한칸 지우기
			    		if(cmpstring[ch_pointer-1]<0)							//한글일경우..
						{
							gotoxy(19+ch_pointer, 23), printf("\b \b\b");		//화면에 2칸씩 지움
							ch_pointer--;
						}
			    		ch_pointer--;
					}
				}
				else if ( ch == 27 ) 
				{
					korsanrank(score*50, stage);
					cls();
					return 0;
				}
				else
				{
					printf("%c", ch);											//화면에 한글자씩 출력
					cmpstring[ch_pointer]=ch;									//배열에 한글자씩 저장 
					ch_pointer++;
				}
			}		
			if(countlife==0)						//HP가 0이면 게임 오바
			{
				korsanrank(score*50, stage);
				jawon_GameOver();
				return 0;
			}
			if(count+(20-templife)==40)
				break;
		}
		stage++;
		continue;
	}
	
	return 0;
}

//랭킹
void korsanrank(int totalscore, int stage)
{
	char* menu[3]={
		"┌───────────────────┐",
		"│　　　　　　　　　　　　　　　　　　　│",
		"└───────────────────┘"};
	int i;
	char name[10];
	char temp[10];
	int scorecheck;
	FILE* fp;
	
	noCursor();

	fp=fopen("korsanranking.DAT", "rb");
	if(fp==NULL)
		fputs("File Open Error!\n", stderr);

	for(i=0; i<30; i++)
		fgets(temp, sizeof(temp), fp);

	fclose(fp);

	scorecheck=atoi(temp);

	if(totalscore>scorecheck)
	{
		textcolor(CC_FONT_YELLOW, 0);
		gotoxy(12,8), printf("%s", menu[0]);
		for(i=1; i<7; i++)
			gotoxy(12, 8+i), printf("%s", menu[1]);
		gotoxy(12, 8+i), printf("%s", menu[2]);
		textcolor(CC_FONT_GREEN, 0);
		gotoxy(26, 10), printf("고득점 입니다!");
		textcolor(CC_FONT_WHITE, 0);
		gotoxy(26, 13), printf("이름 : ");
		textcolor(CC_FONT_BLUE, 0);
		scanf("%s", name);
		textcolor(CC_FONT_WHITE, 0);
	}
	else
		return ;

	korsanrankupdate(name, stage, totalscore);
	korsanrankview();

}

//한글 산성비 랭킹 업데이트
void korsanrankupdate(char name[], int stage, int score)
{
	struct rank ranking[10];								//랭킹 Top 10;
	int i, j;											//루프를 위한 변수
	FILE* fp;	
	
	noCursor();

	fp=fopen("korsanranking.dat", "rb");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	for(i=0; i<10; i++)
	{
		fscanf(fp,"%s", ranking[i].name);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].stage);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].score);
		fseek(fp, 2, SEEK_CUR);
	}
	fclose(fp);

	for(i=0; i<10; i++)
	{
		if(ranking[i].score<score)
		{
			for(j=9; j-1>=i; j--)
			{
				memset(ranking[j].name, '\0', sizeof(ranking[j].name));
				strcpy(ranking[j].name, ranking[j-1].name);	
				ranking[j].stage=ranking[j-1].stage;
				ranking[j].score=ranking[j-1].score;
			}
			memset(ranking[i].name, '\0', sizeof(ranking[i].name));
			strcpy(ranking[i].name, name);
			ranking[i].stage=stage;
			ranking[i].score=score;
			break;
		}
	}

	fp=fopen("korsanranking.dat", "wt");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	
	for(i=0; i<10; i++)
	{
		fprintf(fp, "%s\n", ranking[i].name);
		fprintf(fp, "%d\n", ranking[i].stage);
		fprintf(fp, "%d\n", ranking[i].score);
	}

	fclose(fp);
}

//한글 산성비 랭킹보기 
void korsanrankview(void)
{
	struct rank ranking[10];
	char* tbl[3]={
		"┌─────────────────────────────★",
		"│　　　　　　　　　　　　　　　　　　　　　　　　　　　　　│",
		"□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□"};
	int x=10, y=5;
	int i;
	FILE* fp;	
	
	noCursor();

	fp=fopen("korsanranking.dat", "rb");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	for(i=0; i<10; i++)
	{
		fscanf(fp,"%s", ranking[i].name);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].stage);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].score);
		fseek(fp, 2, SEEK_CUR);
	}
	fclose(fp);
	cls();

	textcolor(CC_FONT_GREEN, 0);
	gotoxy(23, 1), printf("┌────────────────┐");
	gotoxy(23, 2), printf("│　　　　　　　　　　　　　　　　│");
	gotoxy(23, 3), printf("└────────────────┘");
	textcolor(CC_FONT_WHITE, 0);

	textcolor(CC_FONT_YELLOW, 0);
	gotoxy(30, 2), printf("산 성 비 순 위  ");
	textcolor(13, 0);
	printf("(한글)");
	textcolor(15, 0);

	textcolor(32, 0);
	gotoxy(x, y), printf("%s", tbl[0]);
	for(i=1; i<14; i++)
		gotoxy(x, y+i), printf("%s", tbl[1]);
	textcolor(CC_FONT_WHITE, 0);
	textcolor(68, 0);
	gotoxy(x, y+i), printf("%s", tbl[2]);
	textcolor(CC_FONT_WHITE, 0);
	textcolor(47, 0);
	gotoxy(16,6),printf("떠든사람                                     ＃＃\n");
	textcolor(CC_FONT_WHITE, 0);

	for(i=0; i<10; i++)
	{
		textcolor(47, 0);
		gotoxy(16, 8+i); 
		printf("%2d등\t", i+1); 
		printf("이름 : %6s\t", ranking[i].name);
		printf("스테이지 : %2d\t", ranking[i].stage);
		printf("점수 : %5d", ranking[i].score);
		textcolor(CC_FONT_WHITE, 0);
	}
	gotoxy(26,22);
	getch();
}
//한글 산성비 랭킹 포맷 
void korsanrankformat(void)
{
	FILE* fp;
	int i;
	char* menu[3]={
		"┌──────────────────┐",
		"│　　　　　　　　　　　　　　　　　　│",
		"└──────────────────┘"};

	noCursor();

	fp=fopen("korsanranking.dat", "wt");
	if(fp==NULL)
		fputs("File Open Error!\n", stderr);

	for(i=0; i<30; i++)
	{
		fprintf(fp, "익명\n" );
		fprintf(fp, "0\n");
		fprintf(fp, "0\n");
	}

	fclose(fp);

	textcolor(CC_FONT_RED, 0);
	gotoxy(19, 9), printf("%s", menu[0]);
	for(i=1; i<7; i++)
		gotoxy(19, 9+i), printf("%s", menu[1]);
	gotoxy(19, 9+i), printf("%s", menu[2]);
	textcolor(CC_FONT_WHITE, 0);

	textcolor(CC_FONT_GREEN, 0);
	gotoxy(27, 11), printf("점수가 초기화 되었습니다.");
	textcolor(CC_FONT_WHITE, CC_BACK_BLUE);
	gotoxy(37, 14), printf("확인");
	textcolor(CC_FONT_WHITE, 0);
	
	getch();
}

//영문 산성비 
int engsansongbi(int stage)
{
	korwords kor[1000];
	viewwords view[40];		//화면에 뿌려질 40개의 단어
	FILE* fp;
	int index[40];			//랜덤 인덱스 값 40개
	int temp;
	int check;				//중복체크를 위한 변수.
	int i, j;				//루프 변수
	int time1, time2;		//시간 측정.
	int score=0;
	int count=0;
	char cmpstring[20];			
	int ch_pointer;
	char ch;
	int templife=20, countlife=20;				//HP
	char* menu[3]={
		"┌───────────────────────────────┐",
		"│　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　│",
		"└───────────────────────────────┘"};

	noCursor();

	fp=fopen("wordeng.dat", "rb");
	if(fp==NULL)
		printf("File Open Error!\n");

	for(i=0; i<1000; i++)
		fscanf(fp, "%s", kor[i].korword);

	srand((int)time(NULL));

	while(1)
	{
		ready(stage);
		count=0;
		templife=20;
		cls();
		textcolor(10, 0);								//테두리..
		gotoxy(0,0), printf("%s", menu[0]);
		for(i=1; i<21; i++)
			gotoxy(0, i), printf("%s", menu[1]);
		gotoxy(0, i), printf("%s", menu[2]);
		
		textcolor(11, 0);
		gotoxy(15, 22), printf("┌────────────┐");
		gotoxy(15, 23), printf("│　　　　　　　　　　　　│");
		gotoxy(15, 24), printf("└────────────┘");  
		textcolor(15, 0);

		textcolor(11, 0);
		gotoxy(66, 0), printf("┌─────┐");
		gotoxy(66, 1), printf("│　　　　　│");	//산성비
		gotoxy(66, 2), printf("├─────┤");
		gotoxy(66, 3), printf("│　　　　　│");	//한글
		gotoxy(66, 4), printf("├─────┤");
		gotoxy(66, 5), printf("│　　　　　│");	//Stage
		gotoxy(66, 6), printf("├─────┤");
		gotoxy(66, 7), printf("│　　　　　│");	//점수
		gotoxy(66, 8), printf("├─────┤");	//
		for(i=1; i<=10; i++)
			gotoxy(66, 8+i), printf("│　　　　　│");
		gotoxy(66, 8+i), printf("├─────┤");
		gotoxy(66, 9+i), printf("│　　　　　│");
		gotoxy(66, 10+i), printf("└─────┘");
		textcolor(11, 0);

		//HP막대 ♥
		textcolor(12, 0);
		for(i=1; i<=10; i++)
			gotoxy(70, 8+i), printf("♥");

		for(i=1 ; i<=10; i++)
			gotoxy(74, 8+i), printf("♥");
		textcolor(15, 0);

		textcolor(12, 0);
		if(countlife>=10)
		{
			for(i=1; i<=(20-countlife); i++)
			{
				gotoxy(70, 8+i), printf("　");
				gotoxy(19+ch_pointer, 23);
			}
		}
		else
		{	
			for(i=1; i<=10; i++)
				gotoxy(70, 8+i), printf("  ");

			for(i=1 ; i<=(10-countlife); i++)
			{
				gotoxy(74, 8+i), printf("　");
				gotoxy(19+ch_pointer, 23);
			}
		}
		textcolor(15, 0);

		textcolor(14, 0);
		gotoxy(69, 1), printf("산 성 비");
		textcolor(15, 0);

		textcolor(9, 0);
		gotoxy(70, 3), printf("영    문");
		textcolor(15, 0);

		textcolor(13, 0);
		gotoxy(69, 5), printf("Stage %2d", stage);	
		textcolor(15, 0);

		textcolor(10, 0);
		gotoxy(69, 7), printf("%5d 점", 0);
		textcolor(15, 0);

		textcolor(10, 0);
		gotoxy(69, 7), printf("%5d", score*50);
		textcolor(15, 0);

		textcolor(12, 0);
		gotoxy(70, 20), printf("H    P");
		textcolor(15, 0);

		textcolor(8, 0);
		gotoxy(60, 23), printf("Press ESC to quit");
		textcolor(15, 0);

		for(i=0; i<40; i++, check=0)			//중복 방지.
		{
			temp=rand()%1000;
			if(i>0)								//i가 1 이상일 경우부터 중복 검사.
			{
				for(j=0; j<i; j++ )			
				{
					if(temp==index[j])			//난수로 생성된 temp 값이 index 중에 있는지 검사..
						check++;
				}
				if(check!=0)					//만약 중복이 되었다면 새로운 난수 생성..
				{
					i--;
					continue;
				}
				else
					index[i]=temp;				//중복되지 않았다면 index에 대입
			}
			index[i]=temp;
		}
		
		for(i=0; i<40; i++)
		{
			for(j=0; j<=strlen(kor[index[i]].korword); j++)
				view[i].words[j]=kor[index[i]].korword[j];
			view[i].x=(rand()%4)*15+5;
			view[i].y = -2*i;
		}
		
		time1=GetTickCount();
		ch_pointer=0;

		gotoxy(19+ch_pointer, 23);
		cmpstring[ch_pointer]='\0';
		for(j=0; j<40; j++)
		{
			if(strcmp(cmpstring,view[j].words)==0)
			{
	//			sndPlaySound("MsgBell.wav", SND_ASYNC|SND_NODEFAULT);
				strcpy(view[j].words, "             ");

			}
			gotoxy(19+ch_pointer, 23);
		}
		gotoxy(19,23), printf("               ");
		gotoxy(19,23);
		ch_pointer=0;



		while(1)
		{
			ch='\0';
			if(kbhit())
			{
				ch=getch();
				if(ch==-32)
					ch=getch();

				if(ch_pointer==0)
					gotoxy(19, 23);
			}

			time2=GetTickCount();
			if( (time2-time1)>(900-(stage*50)) )
			{
				for(i=0; i<40; i++)
				{
					gotoxy(19+ch_pointer, 23);
					if(view[i].y>0 && view[i].y<=19)
					{
						if(view[i].y>1)
						{
							gotoxy(view[i].x, view[i].y-1), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[i].x, view[i].y-1), printf("             ");
							gotoxy(19+ch_pointer, 23);
							if(view[i].y!=19)
								gotoxy(view[i].x, view[i].y+1), printf("             ");
							gotoxy(19+ch_pointer, 23);
						}
						if(view[i].y!=19)
						{
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[i].x, view[i].y), printf("%s", view[i].words);
							gotoxy(19+ch_pointer, 23);
						}
					}
					view[i].y++;
				}
				time1=GetTickCount();

				for(i=0; i<40; i++)
				{
					if(view[i].words[0]!=' ' && view[i].y==20)
					{
						strcpy(view[i].words, "             ");
						templife--;
						countlife--;
					}
				}
	//			gotoxy(60, 23), printf("%2d", life);
				gotoxy(19+ch_pointer, 23);

				textcolor(12, 0);

				if(countlife>=10)
				{
					for(i=1; i<=(20-countlife); i++)
					{
						gotoxy(70, 8+i), printf("　");
						gotoxy(19+ch_pointer, 23);
					}
				}

				else
				{	
					for(i=1 ; i<=(10-countlife); i++)
					{
						gotoxy(74, 8+i), printf("　");
						gotoxy(19+ch_pointer, 23);
					}
				}

				textcolor(15, 0);
			}

			if(ch!='\0')
			{
				if(ch_pointer==15 || ch==13) 
				{//엔터면 입력 종료.
					gotoxy(19+ch_pointer, 23);
					cmpstring[ch_pointer]='\0';
					for(j=0; j<40; j++)
					{
						if(strcmp(cmpstring,view[j].words)==0)
						{
							sndPlaySound("MsgBell.wav", SND_ASYNC|SND_NODEFAULT);
							strcpy(view[j].words, "             ");
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							gotoxy(view[j].x, view[j].y), printf("             ");
							gotoxy(19+ch_pointer, 23);
							count++;
							score++;
							textcolor(10, 0);
							gotoxy(69, 7), printf("%5d", score*50);
							textcolor(15, 0);
							gotoxy(19+ch_pointer, 23);
							
						}
						gotoxy(19+ch_pointer, 23);
					}
					gotoxy(19,23), printf("               ");
					gotoxy(19,23);
					ch_pointer=0;
				}

				else if ( ch == 8 )
				{ // 백스페이스 누르면
					if ( ch_pointer > 0 )
					{
			    		if(cmpstring[ch_pointer-1]>0)							//한글이 아닐경우
			    			gotoxy(19+ch_pointer, 23), printf("\b \b");			// 화면에 한칸 지우기
			    		if(cmpstring[ch_pointer-1]<0)							//한글일경우..
						{
							gotoxy(19+ch_pointer, 23), printf("\b \b\b");		//화면에 2칸씩 지움
							ch_pointer--;
						}
			    		ch_pointer--;
					}
				}
				else if ( ch == 27 ) 
				{
					engsanrank(score*50, stage);
					cls();
					return 0;
				}
				else
				{
					printf("%c", ch);											//화면에 한글자씩 출력
					cmpstring[ch_pointer]=ch;									//배열에 한글자씩 저장 
					ch_pointer++;
				}
			}		
			if(countlife==0)						//HP가 0이면 게임 오바
			{
				engsanrank(score*50, stage);
				jawon_GameOver();
				return 0;
			}
			if(count+(20-templife)==40)
				break;
		}
		stage++;
		continue;
	}
	
	return 0;
}

//영문 산성비 랭킹
void engsanrank(int totalscore, int stage)
{
	char* menu[3]={
		"┌───────────────────┐",
		"│　　　　　　　　　　　　　　　　　　　│",
		"└───────────────────┘"};
	int i;
	char name[10];
	char temp[10];
	int scorecheck;
	FILE* fp;
	
	noCursor();

	fp=fopen("engsanranking.DAT", "rb");
	if(fp==NULL)
		fputs("File Open Error!\n", stderr);

	for(i=0; i<30; i++)
		fgets(temp, sizeof(temp), fp);

	fclose(fp);

	scorecheck=atoi(temp);

	if(totalscore>scorecheck)
	{
		textcolor(CC_FONT_YELLOW, 0);
		gotoxy(12,8), printf("%s", menu[0]);
		for(i=1; i<7; i++)
			gotoxy(12, 8+i), printf("%s", menu[1]);
		gotoxy(12, 8+i), printf("%s", menu[2]);
		textcolor(CC_FONT_GREEN, 0);
		gotoxy(26, 10), printf("고득점 입니다!");
		textcolor(CC_FONT_WHITE, 0);
		gotoxy(26, 13), printf("이름 : ");
		textcolor(CC_FONT_BLUE, 0);
		scanf("%s", name);
		textcolor(CC_FONT_WHITE, 0);
	}
	else
		return ;

	engsanrankupdate(name, stage, totalscore);
	engsanrankview();

}

//영문 산성비 랭킹 업데이트
void engsanrankupdate(char name[], int stage, int score)
{
	struct rank ranking[10];								//랭킹 Top 10;
	int i, j;											//루프를 위한 변수
	FILE* fp;	
	
	noCursor();

	fp=fopen("engsanranking.dat", "rb");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	for(i=0; i<10; i++)
	{
		fscanf(fp,"%s", ranking[i].name);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].stage);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].score);
		fseek(fp, 2, SEEK_CUR);
	}
	fclose(fp);

	for(i=0; i<10; i++)
	{
		if(ranking[i].score<score)
		{
			for(j=9; j-1>=i; j--)
			{
				memset(ranking[j].name, '\0', sizeof(ranking[j].name));
				strcpy(ranking[j].name, ranking[j-1].name);	
				ranking[j].stage=ranking[j-1].stage;
				ranking[j].score=ranking[j-1].score;
			}
			memset(ranking[i].name, '\0', sizeof(ranking[i].name));
			strcpy(ranking[i].name, name);
			ranking[i].stage=stage;
			ranking[i].score=score;
			break;
		}
	}

	fp=fopen("engsanranking.dat", "wt");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	
	for(i=0; i<10; i++)
	{
		fprintf(fp, "%s\n", ranking[i].name);
		fprintf(fp, "%d\n", ranking[i].stage);
		fprintf(fp, "%d\n", ranking[i].score);
	}

	fclose(fp);
}

//영문 산성비 랭킹보기 
void engsanrankview(void)
{
	struct rank ranking[10];
	char* tbl[3]={
		"┌─────────────────────────────★",
		"│　　　　　　　　　　　　　　　　　　　　　　　　　　　　　│",
		"□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□□"};
	int x=10, y=5;
	int i;
	FILE* fp;	
	
	noCursor();

	fp=fopen("engsanranking.dat", "rb");
	if(fp==NULL)
		fputs("File Open error!\n", stderr);
	for(i=0; i<10; i++)
	{
		fscanf(fp,"%s", ranking[i].name);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].stage);
		fseek(fp, 2, SEEK_CUR);
		fscanf(fp,"%d", &ranking[i].score);
		fseek(fp, 2, SEEK_CUR);
	}
	fclose(fp);
	cls();

	textcolor(CC_FONT_GREEN, 0);
	gotoxy(23, 1), printf("┌────────────────┐");
	gotoxy(23, 2), printf("│　　　　　　　　　　　　　　　　│");
	gotoxy(23, 3), printf("└────────────────┘");
	textcolor(CC_FONT_WHITE, 0);

	textcolor(CC_FONT_YELLOW, 0);
	gotoxy(30, 2), printf("산 성 비 순 위  ");
	textcolor(13, 0);
	printf("(영문)");
	textcolor(15, 0);

	textcolor(32, 0);
	gotoxy(x, y), printf("%s", tbl[0]);
	for(i=1; i<14; i++)
		gotoxy(x, y+i), printf("%s", tbl[1]);
	textcolor(CC_FONT_WHITE, 0);
	textcolor(68, 0);
	gotoxy(x, y+i), printf("%s", tbl[2]);
	textcolor(CC_FONT_WHITE, 0);
	textcolor(47, 0);
	gotoxy(16,6),printf("떠든사람                                     ＃＃\n");
	textcolor(CC_FONT_WHITE, 0);

	for(i=0; i<10; i++)
	{
		textcolor(47, 0);
		gotoxy(16, 8+i); 
		printf("%2d등\t", i+1); 
		printf("이름 : %6s\t", ranking[i].name);
		printf("스테이지 : %2d\t", ranking[i].stage);
		printf("점수 : %5d", ranking[i].score);
		textcolor(CC_FONT_WHITE, 0);
	}
	gotoxy(26,22);
	getch();
}
//영문 산성비 랭킹 포맷 
void engsanrankformat(void)
{
	FILE* fp;
	int i;
	char* menu[3]={
		"┌──────────────────┐",
		"│　　　　　　　　　　　　　　　　　　│",
		"└──────────────────┘"};

	noCursor();

	fp=fopen("engsanranking.dat", "wt");
	if(fp==NULL)
		fputs("File Open Error!\n", stderr);

	for(i=0; i<30; i++)
	{
		fprintf(fp, "익명\n" );
		fprintf(fp, "0\n");
		fprintf(fp, "0\n");
	}

	fclose(fp);

	textcolor(CC_FONT_RED, 0);
	gotoxy(19, 9), printf("%s", menu[0]);
	for(i=1; i<7; i++)
		gotoxy(19, 9+i), printf("%s", menu[1]);
	gotoxy(19, 9+i), printf("%s", menu[2]);
	textcolor(CC_FONT_WHITE, 0);

	textcolor(CC_FONT_GREEN, 0);
	gotoxy(27, 11), printf("점수가 초기화 되었습니다.");
	textcolor(CC_FONT_WHITE, CC_BACK_BLUE);
	gotoxy(37, 14), printf("확인");
	textcolor(CC_FONT_WHITE, 0);
	
	getch();
}